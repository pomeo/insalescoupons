{"version":3,"sources":["addons/htmleditor.js"],"names":["addon","component","jQuery","UIkit","define","amd","$","UI","editors","defaults","iframe","mode","markdown","autocomplete","height","maxsplitsize","markedOptions","gfm","tables","breaks","pedantic","sanitize","smartLists","smartypants","langPrefix","codemirror","lineWrapping","dragDrop","autoCloseTags","matchTags","autoCloseBrackets","matchBrackets","indentUnit","indentWithTabs","tabSize","hintOptions","completionSingle","toolbar","lblPreview","lblCodeview","lblMarkedview","init","$this","this","tpl","components","htmleditor","template","CodeMirror","options","buttons","replace","content","find","preview","children","eq","code","element","before","appendTo","editor","fromTextArea","on","Utils","debounce","render","save","css","append","contentWindow","document","open","close","container","parent","$win","fit","previewContainer","codeContent","codeScroll","attr","codeHeight","previewHeight","scrollHeight","ratio","previewPostition","scrollTop","e","preventDefault","removeClass","filter","addClass","activetab","hasClass","refresh","is","trigger","data","showHint","hint","html","doc","getDoc","POS","getCursor","innerMode","getMode","getTokenAt","state","name","cur","token","string","charAt","type","completeSingle","debouncedRedraw","redraw","bind","push","addButton","button","addButtons","extend","replaceInPreview","regexp","callback","translateOffset","offset","result","getValue","substring","split","line","length","ch","results","value","currentvalue","indexOf","arguments","match","matches","from","to","replaceRange","inRange","cursor","_buildtoolbar","bar","empty","forEach","title","label","join","width","getOption","getCursorMode","param","val","addShortcut","map","isArray","key","addKeyMap","addShortcutAction","action","shortcuts","replaceSelection","text","getSelection","curLine","getLine","start","end","test","curWord","slice","setSelection","focus","replaceLine","pos","setCursor","plugin","addAction","fullscreen","bold","italic","strike","blockquote","link","image","listUl","listOl","listfn","cm","posend","i","toggleClass","wrap","getWrapperElement","fullScreenRestore","window","pageYOffset","scrollLeft","pageXOffset","style","documentElement","overflow","info","scrollTo","setTimeout","enableMarkdown","setOption","parser","marked","setOptions","prefix","prevline","Number","base","htmlState","disableMarkdown","each","obj"],"mappings":"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","file":"addons/htmleditor.js","sourcesContent":["/*! UIkit 2.9.0 | http://www.getuikit.com | (c) 2014 YOOtheme | MIT License */\n\n(function(addon) {\n\n    var component;\n\n    if (jQuery && jQuery.UIkit) {\n        component = addon(jQuery, jQuery.UIkit);\n    }\n\n    if (typeof define == \"function\" && define.amd) {\n        define(\"uikit-htmleditor\", [\"uikit\"], function(){\n            return component || addon(jQuery, jQuery.UIkit);\n        });\n    }\n\n})(function($, UI) {\n\n    var editors = [];\n\n    UI.component('htmleditor', {\n\n        defaults: {\n            iframe       : false,\n            mode         : 'split',\n            markdown     : false,\n            autocomplete : true,\n            height       : 500,\n            maxsplitsize : 1000,\n            markedOptions: { gfm: true, tables: true, breaks: true, pedantic: true, sanitize: false, smartLists: true, smartypants: false, langPrefix: 'lang-'},\n            codemirror   : { mode: 'htmlmixed', lineWrapping: true, dragDrop: false, autoCloseTags: true, matchTags: true, autoCloseBrackets: true, matchBrackets: true, indentUnit: 4, indentWithTabs: false, tabSize: 4, hintOptions: {completionSingle:false} },\n            toolbar      : [ 'bold', 'italic', 'strike', 'link', 'image', 'blockquote', 'listUl', 'listOl' ],\n            lblPreview   : 'Preview',\n            lblCodeview  : 'HTML',\n            lblMarkedview: 'Markdown'\n        },\n\n        init: function() {\n\n            var $this = this, tpl = UI.components.htmleditor.template;\n\n            this.CodeMirror = this.options.CodeMirror || CodeMirror;\n            this.buttons    = {};\n\n            tpl = tpl.replace(/\\{:lblPreview\\}/g, this.options.lblPreview);\n            tpl = tpl.replace(/\\{:lblCodeview\\}/g, this.options.lblCodeview);\n\n            this.htmleditor = $(tpl);\n            this.content    = this.htmleditor.find('.uk-htmleditor-content');\n            this.toolbar    = this.htmleditor.find('.uk-htmleditor-toolbar');\n            this.preview    = this.htmleditor.find('.uk-htmleditor-preview').children().eq(0);\n            this.code       = this.htmleditor.find('.uk-htmleditor-code');\n\n            this.element.before(this.htmleditor).appendTo(this.code);\n            this.editor = this.CodeMirror.fromTextArea(this.element[0], this.options.codemirror);\n            this.editor.htmleditor = this;\n            this.editor.on('change', UI.Utils.debounce(function() { $this.render(); }, 150));\n            this.editor.on('change', function() { $this.editor.save(); });\n            this.code.find('.CodeMirror').css('height', this.options.height);\n\n            // iframe mode?\n            if (this.options.iframe) {\n\n                this.iframe = $('<iframe class=\"uk-htmleditor-iframe\" frameborder=\"0\" scrolling=\"auto\" height=\"100\" width=\"100%\"></iframe>');\n                this.preview.append(this.iframe);\n\n                // must open and close document object to start using it!\n                this.iframe[0].contentWindow.document.open();\n                this.iframe[0].contentWindow.document.close();\n\n                this.preview.container = $(this.iframe[0].contentWindow.document).find('body');\n\n                // append custom stylesheet\n                if (typeof(this.options.iframe) === 'string') {\n                   this.preview.container.parent().append('<link rel=\"stylesheet\" href=\"'+this.options.iframe+'\">');\n                }\n\n            } else {\n                this.preview.container = this.preview;\n            }\n\n            UI.$win.on('resize', UI.Utils.debounce(function() { $this.fit(); }, 200));\n\n            var previewContainer = this.iframe ? this.preview.container:$this.preview.parent(),\n                codeContent      = this.code.find('.CodeMirror-sizer'),\n                codeScroll       = this.code.find('.CodeMirror-scroll').on('scroll', UI.Utils.debounce(function() {\n\n                    if ($this.htmleditor.attr('data-mode') == 'tab') return;\n\n                    // calc position\n                    var codeHeight       = codeContent.height() - codeScroll.height(),\n                        previewHeight    = previewContainer[0].scrollHeight - ($this.iframe ? $this.iframe.height() : previewContainer.height()),\n                        ratio            = previewHeight / codeHeight,\n                        previewPostition = codeScroll.scrollTop() * ratio;\n\n                    // apply new scroll\n                    previewContainer.scrollTop(previewPostition);\n\n                }, 10));\n\n            this.htmleditor.on('click', '.uk-htmleditor-button-code, .uk-htmleditor-button-preview', function(e) {\n\n                e.preventDefault();\n\n                if ($this.htmleditor.attr('data-mode') == 'tab') {\n\n                    $this.htmleditor.find('.uk-htmleditor-button-code, .uk-htmleditor-button-preview').removeClass('uk-active').filter(this).addClass('uk-active');\n\n                    $this.activetab = $(this).hasClass('uk-htmleditor-button-code') ? 'code' : 'preview';\n                    $this.htmleditor.attr('data-active-tab', $this.activetab);\n                    $this.editor.refresh();\n                }\n            });\n\n            // toolbar actions\n            this.htmleditor.on('click', 'a[data-htmleditor-button]', function() {\n\n                if (!$this.code.is(':visible')) return;\n\n                $this.trigger('action.' + $(this).data('htmleditor-button'), [$this.editor]);\n            });\n\n            this.preview.parent().css('height', this.code.height());\n\n            // autocomplete\n            if (this.options.autocomplete && this.CodeMirror.showHint && this.CodeMirror.hint && this.CodeMirror.hint.html) {\n\n                this.editor.on('inputRead', UI.Utils.debounce(function() {\n                    var doc = $this.editor.getDoc(), POS = doc.getCursor(), mode = $this.CodeMirror.innerMode($this.editor.getMode(), $this.editor.getTokenAt(POS).state).mode.name;\n\n                    if (mode == 'xml') { //html depends on xml\n\n                        var cur = $this.editor.getCursor(), token = $this.editor.getTokenAt(cur);\n\n                        if (token.string.charAt(0) == '<' || token.type == 'attribute') {\n                            $this.CodeMirror.showHint($this.editor, $this.CodeMirror.hint.html, { completeSingle: false });\n                        }\n                    }\n                }, 100));\n            }\n\n            this.debouncedRedraw = UI.Utils.debounce(function () { $this.redraw(); }, 5);\n\n            this.on('init', function() {\n                $this.redraw();\n            });\n\n            this.element.attr('data-uk-check-display', 1).on('uk-check-display', function(e) {\n                if(this.htmleditor.is(\":visible\")) this.fit();\n            }.bind(this));\n\n            editors.push(this);\n        },\n\n        addButton: function(name, button) {\n            this.buttons[name] = button;\n        },\n\n        addButtons: function(buttons) {\n            $.extend(this.buttons, buttons);\n        },\n\n        replaceInPreview: function(regexp, callback) {\n\n            var editor = this.editor, results = [], value = editor.getValue(), offset = -1;\n\n            this.currentvalue = this.currentvalue.replace(regexp, function() {\n\n                offset = value.indexOf(arguments[0], ++offset);\n\n                var match  = {\n                    matches: arguments,\n                    from   : translateOffset(offset),\n                    to     : translateOffset(offset + arguments[0].length),\n                    replace: function(value) {\n                        editor.replaceRange(value, match.from, match.to);\n                    },\n                    inRange: function(cursor) {\n\n                        if (cursor.line === match.from.line && cursor.line === match.to.line) {\n                            return cursor.ch >= match.from.ch && cursor.ch < match.to.ch;\n                        }\n\n                        return  (cursor.line === match.from.line && cursor.ch   >= match.from.ch)\n                            || (cursor.line >   match.from.line && cursor.line <  match.to.line)\n                            || (cursor.line === match.to.line   && cursor.ch   <  match.to.ch);\n                    }\n                };\n\n                var result = callback(match);\n\n                if (result == false) {\n                    return arguments[0];\n                }\n\n                results.push(match);\n                return result;\n            });\n\n            function translateOffset(offset) {\n                var result = editor.getValue().substring(0, offset).split('\\n');\n                return { line: result.length - 1, ch: result[result.length - 1].length }\n            }\n\n            return results;\n        },\n\n        _buildtoolbar: function() {\n\n            if (!(this.options.toolbar && this.options.toolbar.length)) return;\n\n            var $this = this, bar = [];\n\n            this.toolbar.empty();\n\n            this.options.toolbar.forEach(function(button) {\n                if (!$this.buttons[button]) return;\n\n                var title = $this.buttons[button].title ? $this.buttons[button].title : button;\n\n                bar.push('<li><a data-htmleditor-button=\"'+button+'\" title=\"'+title+'\" data-uk-tooltip>'+$this.buttons[button].label+'</a></li>');\n            });\n\n            this.toolbar.html(bar.join('\\n'));\n        },\n\n        fit: function() {\n\n            var mode = this.options.mode;\n\n            if (mode == 'split' && this.htmleditor.width() < this.options.maxsplitsize) {\n                mode = 'tab';\n            }\n\n            if (mode == 'tab') {\n                if (!this.activetab) {\n                    this.activetab = 'code';\n                    this.htmleditor.attr('data-active-tab', this.activetab);\n                }\n\n                this.htmleditor.find('.uk-htmleditor-button-code, .uk-htmleditor-button-preview').removeClass('uk-active')\n                    .filter(this.activetab == 'code' ? '.uk-htmleditor-button-code' : '.uk-htmleditor-button-preview')\n                    .addClass('uk-active');\n            }\n\n            this.editor.refresh();\n            this.preview.parent().css('height', this.code.height());\n\n            this.htmleditor.attr('data-mode', mode);\n        },\n\n        redraw: function() {\n            this._buildtoolbar();\n            this.render();\n            this.fit();\n        },\n\n        getMode: function() {\n            return this.editor.getOption('mode');\n        },\n\n        getCursorMode: function() {\n            var param = { mode: 'html'};\n            this.trigger('cursorMode', [param]);\n            return param.mode;\n        },\n\n        render: function() {\n\n            this.currentvalue = this.editor.getValue();\n\n            // empty code\n            if (!this.currentvalue) {\n\n                this.element.val('');\n                this.preview.container.html('');\n\n                return;\n            }\n\n            this.trigger('render', [this]);\n            this.trigger('renderLate', [this]);\n\n            this.preview.container.html(this.currentvalue);\n        },\n\n        addShortcut: function(name, callback) {\n            var map = {};\n            if (!$.isArray(name)) {\n                name = [name];\n            }\n\n            name.forEach(function(key) {\n                map[key] = callback;\n            });\n\n            this.editor.addKeyMap(map);\n\n            return map;\n        },\n\n        addShortcutAction: function(action, shortcuts) {\n            var editor = this;\n            this.addShortcut(shortcuts, function() {\n                editor.element.trigger('action.' + action, [editor.editor]);\n            });\n        },\n\n        replaceSelection: function(replace) {\n\n            var text = this.editor.getSelection();\n\n            if (!text.length) {\n\n                var cur     = this.editor.getCursor(),\n                    curLine = this.editor.getLine(cur.line),\n                    start   = cur.ch,\n                    end     = start;\n\n                while (end < curLine.length && /[\\w$]+/.test(curLine.charAt(end))) ++end;\n                while (start && /[\\w$]+/.test(curLine.charAt(start - 1))) --start;\n\n                var curWord = start != end && curLine.slice(start, end);\n\n                if (curWord) {\n                    this.editor.setSelection({ line: cur.line, ch: start}, { line: cur.line, ch: end });\n                    text = curWord;\n                }\n            }\n\n            var html = replace.replace('$1', text);\n\n            this.editor.replaceSelection(html, 'end');\n            this.editor.focus();\n        },\n\n        replaceLine: function(replace) {\n            var pos  = this.editor.getDoc().getCursor(),\n                text = this.editor.getLine(pos.line),\n                html = replace.replace('$1', text);\n\n            this.editor.replaceRange(html , { line: pos.line, ch: 0 }, { line: pos.line, ch: text.length });\n            this.editor.setCursor({ line: pos.line, ch: html.length });\n            this.editor.focus();\n        },\n\n        save: function() {\n            this.editor.save();\n        }\n    });\n\n\n    UI.components.htmleditor.template = [\n        '<div class=\"uk-htmleditor uk-clearfix\" data-mode=\"split\">',\n            '<div class=\"uk-htmleditor-navbar\">',\n                '<ul class=\"uk-htmleditor-navbar-nav uk-htmleditor-toolbar\"></ul>',\n                '<div class=\"uk-htmleditor-navbar-flip\">',\n                    '<ul class=\"uk-htmleditor-navbar-nav\">',\n                        '<li class=\"uk-htmleditor-button-code\"><a>{:lblCodeview}</a></li>',\n                        '<li class=\"uk-htmleditor-button-preview\"><a>{:lblPreview}</a></li>',\n                        '<li><a data-htmleditor-button=\"fullscreen\"><i class=\"uk-icon-expand\"></i></a></li>',\n                    '</ul>',\n                '</div>',\n            '</div>',\n            '<div class=\"uk-htmleditor-content\">',\n                '<div class=\"uk-htmleditor-code\"></div>',\n                '<div class=\"uk-htmleditor-preview\"><div></div></div>',\n            '</div>',\n        '</div>'\n    ].join('');\n\n\n    UI.plugin('htmleditor', 'base', {\n\n        init: function(editor) {\n\n            editor.addButtons({\n\n                fullscreen: {\n                    title  : 'Fullscreen',\n                    label  : '<i class=\"uk-icon-expand\"></i>'\n                },\n                bold : {\n                    title  : 'Bold',\n                    label  : '<i class=\"uk-icon-bold\"></i>'\n                },\n                italic : {\n                    title  : 'Italic',\n                    label  : '<i class=\"uk-icon-italic\"></i>'\n                },\n                strike : {\n                    title  : 'Strikethrough',\n                    label  : '<i class=\"uk-icon-strikethrough\"></i>'\n                },\n                blockquote : {\n                    title  : 'Blockquote',\n                    label  : '<i class=\"uk-icon-quote-right\"></i>'\n                },\n                link : {\n                    title  : 'Link',\n                    label  : '<i class=\"uk-icon-link\"></i>'\n                },\n                image : {\n                    title  : 'Image',\n                    label  : '<i class=\"uk-icon-picture-o\"></i>'\n                },\n                listUl : {\n                    title  : 'Unordered List',\n                    label  : '<i class=\"uk-icon-list-ul\"></i>'\n                },\n                listOl : {\n                    title  : 'Ordered List',\n                    label  : '<i class=\"uk-icon-list-ol\"></i>'\n                }\n\n            });\n\n            addAction('bold', '<strong>$1</strong>');\n            addAction('italic', '<em>$1</em>');\n            addAction('strike', '<del>$1</del>');\n            addAction('blockquote', '<blockquote><p>$1</p></blockquote>', 'replaceLine');\n            addAction('link', '<a href=\"http://\">$1</a>');\n            addAction('image', '<img src=\"http://\" alt=\"$1\">');\n\n            var listfn = function() {\n                if (editor.getCursorMode() == 'html') {\n\n                    var cm      = editor.editor,\n                        pos     = cm.getDoc().getCursor(true),\n                        posend  = cm.getDoc().getCursor(false);\n\n                    for (var i=pos.line; i<(posend.line+1);i++) {\n                        cm.replaceRange('<li>'+cm.getLine(i)+'</li>', { line: i, ch: 0 }, { line: i, ch: cm.getLine(i).length });\n                    }\n\n                    cm.setCursor({ line: posend.line, ch: cm.getLine(posend.line).length });\n                    cm.focus();\n                }\n            }\n\n            editor.on('action.listUl', function() {\n                listfn();\n            });\n\n            editor.on('action.listOl', function() {\n                listfn();\n            });\n\n            editor.htmleditor.on('click', 'a[data-htmleditor-button=\"fullscreen\"]', function() {\n                editor.htmleditor.toggleClass('uk-htmleditor-fullscreen');\n\n                var wrap = editor.editor.getWrapperElement();\n\n                if (editor.htmleditor.hasClass('uk-htmleditor-fullscreen')) {\n\n                    editor.editor.state.fullScreenRestore = {scrollTop: window.pageYOffset, scrollLeft: window.pageXOffset, width: wrap.style.width, height: wrap.style.height};\n                    wrap.style.width  = '';\n                    wrap.style.height = editor.content.height()+'px';\n                    document.documentElement.style.overflow = 'hidden';\n\n                } else {\n\n                    document.documentElement.style.overflow = '';\n                    var info = editor.editor.state.fullScreenRestore;\n                    wrap.style.width = info.width; wrap.style.height = info.height;\n                    window.scrollTo(info.scrollLeft, info.scrollTop);\n                }\n\n                setTimeout(function() {\n                    editor.fit();\n                    UI.$win.trigger('resize');\n                }, 50);\n            });\n\n            editor.addShortcut(['Ctrl-S', 'Cmd-S'], function() { editor.element.trigger('htmleditor-save', [editor]); });\n            editor.addShortcutAction('bold', ['Ctrl-B', 'Cmd-B']);\n\n            function addAction(name, replace, mode) {\n                editor.on('action.'+name, function() {\n                    if (editor.getCursorMode() == 'html') {\n                        editor[mode == 'replaceLine' ? 'replaceLine' : 'replaceSelection'](replace);\n                    }\n                });\n            }\n        }\n    });\n\n    UI.plugin('htmleditor', 'markdown', {\n\n        init: function(editor) {\n\n            var parser = editor.options.marked || marked;\n\n            if (!parser) return;\n\n            parser.setOptions(editor.options.markedOptions);\n\n            if (editor.options.markdown) {\n                enableMarkdown()\n            }\n\n            addAction('bold', '**$1**');\n            addAction('italic', '*$1*');\n            addAction('strike', '~~$1~~');\n            addAction('blockquote', '> $1', 'replaceLine');\n            addAction('link', '[$1](http://)');\n            addAction('image', '![$1](http://)');\n\n            editor.on('action.listUl', function() {\n\n                if (editor.getCursorMode() == 'markdown') {\n\n                    var cm      = editor.editor,\n                        pos     = cm.getDoc().getCursor(true),\n                        posend  = cm.getDoc().getCursor(false);\n\n                    for (var i=pos.line; i<(posend.line+1);i++) {\n                        cm.replaceRange('* '+cm.getLine(i), { line: i, ch: 0 }, { line: i, ch: cm.getLine(i).length });\n                    }\n\n                    cm.setCursor({ line: posend.line, ch: cm.getLine(posend.line).length });\n                    cm.focus();\n                }\n            });\n\n            editor.on('action.listOl', function() {\n\n                if (editor.getCursorMode() == 'markdown') {\n\n                    var cm      = editor.editor,\n                        pos     = cm.getDoc().getCursor(true),\n                        posend  = cm.getDoc().getCursor(false),\n                        prefix  = 1;\n\n                    if (pos.line > 0) {\n                        var prevline = cm.getLine(pos.line-1), matches;\n\n                        if(matches = prevline.match(/^(\\d+)\\./)) {\n                            prefix = Number(matches[1])+1;\n                        }\n                    }\n\n                    for (var i=pos.line; i<(posend.line+1);i++) {\n                        cm.replaceRange(prefix+'. '+cm.getLine(i), { line: i, ch: 0 }, { line: i, ch: cm.getLine(i).length });\n                        prefix++;\n                    }\n\n                    cm.setCursor({ line: posend.line, ch: cm.getLine(posend.line).length });\n                    cm.focus();\n                }\n            });\n\n            editor.on('renderLate', function() {\n                if (editor.editor.options.mode == 'gfm') {\n                    editor.currentvalue = parser(editor.currentvalue);\n                }\n            });\n\n            editor.on('cursorMode', function(e, param) {\n                if (editor.editor.options.mode == 'gfm') {\n                    var pos = editor.editor.getDoc().getCursor();\n                    if (!editor.editor.getTokenAt(pos).state.base.htmlState) {\n                        param.mode = 'markdown';\n                    }\n                }\n            });\n\n            $.extend(editor, {\n\n                enableMarkdown: function() {\n                    enableMarkdown()\n                    this.render();\n                },\n                disableMarkdown: function() {\n                    this.editor.setOption('mode', 'htmlmixed');\n                    this.htmleditor.find('.uk-htmleditor-button-code a').html(this.options.lblCodeview);\n                    this.render();\n                }\n\n            });\n\n            // switch markdown mode on event\n            editor.on({\n                enableMarkdown  : function() { editor.enableMarkdown(); },\n                disableMarkdown : function() { editor.disableMarkdown(); }\n            });\n\n            function enableMarkdown() {\n                editor.editor.setOption('mode', 'gfm');\n                editor.htmleditor.find('.uk-htmleditor-button-code a').html(editor.options.lblMarkedview);\n            }\n\n            function addAction(name, replace, mode) {\n                editor.on('action.'+name, function() {\n                    if (editor.getCursorMode() == 'markdown') {\n                        editor[mode == 'replaceLine' ? 'replaceLine' : 'replaceSelection'](replace);\n                    }\n                });\n            }\n        }\n    });\n\n    // init code\n    $(function() {\n        $('textarea[data-uk-htmleditor]').each(function() {\n            var editor = $(this), obj;\n\n            if (!editor.data('htmleditor')) {\n                obj = UI.htmleditor(editor, UI.Utils.options(editor.attr('data-uk-htmleditor')));\n            }\n        });\n    });\n\n    return UI.htmleditor;\n});"],"sourceRoot":"/source/"}