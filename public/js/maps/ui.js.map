{"version":3,"sources":["ui.js"],"names":["$","document","ready","sample","n","val","p","l","getJSON","number","parts","length","data","html","validator","addMethod","value","element","this","optional","test","validate","errorClass","validClass","highlight","addClass","removeClass","unhighlight","rules","c-num","required","range","c-part","c-partlen","discount","until","dateNL","group","loginRegex","submitHandler","form","ajaxSubmit","success","response","UIkit","notify","status","submit","click","ajax","type","url","done","change","remove","prepend","grid","columns","id","name","field","sortable","options","enableCellNavigation","enableColumnReorder","syncColumnCellResize","multiColumnSort","forceFitColumns","loadingIndicator","appendTo","body","$g","css","position","top","height","left","width","fadeIn","dataType","error","i","code","coll","disc","expired","disabled","worked","Slick","Grid","fadeOut","onSort","subscribe","e","args","cols","sortCols","sort","dataRow1","dataRow2","sortCol","sign","sortAsc","value1","value2","result","invalidate","render","progressbar","bar","find","settings","action","allow","loadstart","text","progress","percent","Math","ceil","allcomplete","setTimeout","uploadSelect","uploadDrop"],"mappings":"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","file":"ui.js","sourcesContent":["$(document).ready(function() {\n  if ($(\"#coupons\").length !== 0) {\n    sample();\n  }\n  $.validator.addMethod('loginRegex', function(value, element) {\n    return this.optional(element) || /^[a-zA-Zа-яА-Я0-9\\-]+$/i.test(value);\n  }, 'Только цифры, буквы и дефис');\n  $('#coupons-generate').validate({\n    errorClass: 'uk-form-danger',\n    validClass: 'uk-form-success',\n    highlight: function(element, errorClass, validClass) {\n      $(element).addClass(errorClass).removeClass(validClass);\n    },\n    unhighlight: function(element, errorClass, validClass) {\n      $(element).removeClass(errorClass).addClass(validClass);\n    },\n    rules: {\n      'c-num': {\n        required: true,\n        range: [1, 10000]\n      },\n      'c-part': {\n        required: true,\n        range: [1, 5]\n      },\n      'c-partlen': {\n        required: true,\n        range: [4, 10]\n      },\n      discount: {\n        required: true\n      },\n      until: {\n        required: true,\n        dateNL: true\n      },\n      group: {\n        loginRegex: true\n      }\n    },\n    submitHandler: function(form) {\n      $(form).ajaxSubmit({\n        success: function (response) {\n          if (response == 'success') {\n            $.UIkit.notify(\"<i class='uk-icon-check'></i> Отправлено в очередь на выполнение.<br />Состояние можно посмотреть на странице <a href='/zadaniya'>&laquo;Задания&raquo;</a>.\", {status:'success'})\n          } else {\n            $.UIkit.notify(\"ошибка\", {status:'danger'});\n          }\n        }\n      });\n      return false;\n    }\n  })\n  $(\"#coupons-delete\").submit(function() {\n    $(this).ajaxSubmit({\n      success: function (response) {\n        if (response == 'success') {\n          $.UIkit.notify(\"<i class='uk-icon-check'></i> Отправлено в очередь на выполнение.<br />Состояние можно посмотреть на странице <a href='/zadaniya'>&laquo;Задания&raquo;</a>.\", {status:'success'})\n        } else {\n          $.UIkit.notify(\"ошибка\", {status:'danger'});\n        }\n      }\n    });\n    return false;\n  });\n  $(\"#button-sync\").click(function() {\n    $.ajax({\n      type: \"POST\",\n      url: \"/input\",\n      data: { data: 1 }\n    })\n    .done(function(response) {\n      if (response == \"success\") {\n        $.UIkit.notify(\"<i class='uk-icon-check'></i> Отправлено в очередь на выполнение.<br />Состояние можно посмотреть на странице <a href='/zadaniya'>&laquo;Задания&raquo;</a>.\", {status:'success'})\n      } else {\n        $.UIkit.notify(\"ошибка\", {status:'danger'});\n      }\n    });\n  });\n  $(\"#button-export\").click(function() {\n    $.ajax({\n      type: \"POST\",\n      url: \"/input\",\n      data: { data: 2 }\n    })\n    .done(function(response) {\n      if (response == \"success\") {\n        $.UIkit.notify(\"<i class='uk-icon-check'></i> Отправлено в очередь на выполнение.<br />Состояние можно посмотреть на странице <a href='/zadaniya'>&laquo;Задания&raquo;</a>.\", {status:'success'})\n      } else {\n        $.UIkit.notify(\"ошибка\", {status:'danger'});\n      }\n    });\n  });\n  $(\"input[name='c-part'], input[name='c-partlen']\").change(sample);\n  function sample() {\n    var n = $(\"input[name='c-num']\").val();\n    var p = $(\"input[name='c-part']\").val();\n    var l = $(\"input[name='c-partlen']\").val();\n    $.getJSON( \"/sample\", { number: n, parts: p, length: l }, function(data) {\n      $(\"#coupon-sample\").html(data);\n    });\n  };\n  $(\"select[name='typediscount']\").change(function() {\n    if ($(\"select[name='typediscount']\").val() == 1) {\n      $(\".uk-icon-percent\").remove();\n      $(\".uk-icon-rub\").remove();\n      $(\"#b-discount\").prepend(\"<i class='uk-icon-percent'></i>\");\n    } else {\n      $(\".uk-icon-percent\").remove();\n      $(\".uk-icon-rub\").remove();\n      $(\"#b-discount\").prepend(\"<i class='uk-icon-rub'></i>\");\n    }\n  });\n  if ($(\"#coupons\").length !== 0) {\n    var grid;\n    var columns = [\n      {id: \"code\", name: \"Код купона\", field: \"code\", sortable: true},\n      {id: \"type\", name: \"Тип\", field: \"type\", sortable: true},\n      {id: \"coll\", name: \"Категории\", field: \"coll\", sortable: true},\n      {id: \"disc\", name: \"Скидка\", field: \"disc\", sortable: true},\n      {id: \"expired\", name: \"Действителен по\", field: \"expired\", sortable: true},\n      {id: \"disabled\", name: \"Заблокирован\", field: \"disabled\", sortable: true},\n      {id: \"worked\", name: \"Использован\", field: \"worked\", sortable: true}\n    ];\n    var options = {\n      enableCellNavigation: true,\n      enableColumnReorder: false,\n      syncColumnCellResize: true,\n      multiColumnSort: true,\n      forceFitColumns: true\n    };\n\n    var loadingIndicator = null;\n    if (!loadingIndicator) {\n      loadingIndicator = $(\"<span class='loading-indicator'><img src='/img/tail-spin.svg' />Загрузка купонов</span>\").appendTo(document.body);\n      var $g = $(\"#coupons\");\n      loadingIndicator\n      .css(\"display\", \"none\")\n      .css(\"position\", \"absolute\")\n      .css(\"top\", $g.position().top + $g.height() / 2 - loadingIndicator.height() / 2)\n      .css(\"left\", $g.position().left + $g.width() / 2 - loadingIndicator.width() / 2);\n    }\n    loadingIndicator.fadeIn();\n\n    $.ajax({\n      url: '/data',\n      dataType: \"json\",\n      error: function (jqXHR, textStatus, errorThrown) {\n        loadingIndicator.html(\"<span class='loading-indicator'>Ошибка загрузки купонов<br />попробуйте обновить страницу</span>\");\n      },\n      success: function(data) {\n        $(\"#b-coupon-sum\").html(data.length);\n        for (var i = 0; i < data.length; i++) {\n          data[i] = {\n            code: data[i].code,\n            type: data[i].type,\n            coll: data[i].coll,\n            disc: data[i].disc,\n            expired: data[i].expired,\n            disabled: data[i].disabled,\n            worked: data[i].worked\n          }\n        }\n        grid = new Slick.Grid(\"#coupons\", data, columns, options);\n        if (data.length == 0) {\n          loadingIndicator.html(\"<span class='loading-indicator'>Купоны отсутствуют<br />в базе приложения</span>\");\n        } else {\n          loadingIndicator.fadeOut();\n        }\n        grid.onSort.subscribe(function (e, args) {\n          var cols = args.sortCols;\n          data.sort(function (dataRow1, dataRow2) {\n            for (var i = 0, l = cols.length; i < l; i++) {\n              var field = cols[i].sortCol.field;\n              var sign = cols[i].sortAsc ? 1 : -1;\n              var value1 = dataRow1[field], value2 = dataRow2[field];\n              var result = (value1 == value2 ? 0 : (value1 > value2 ? 1 : -1)) * sign;\n              if (result != 0) {\n                return result;\n              }\n            }\n            return 0;\n          });\n          grid.invalidate();\n          grid.render();\n        });\n      }\n    });\n  }\n  if ($(\"#progressbar\")) {\n    var progressbar = $(\"#progressbar\"),\n        bar         = progressbar.find('.uk-progress-bar'),\n        settings    = {\n          action: '/import',\n          allow : '*.(xlsx)',\n          loadstart: function() {\n            bar.css(\"width\", \"0%\").text(\"0%\");\n            progressbar.removeClass(\"uk-hidden\");\n          },\n          progress: function(percent) {\n            percent = Math.ceil(percent);\n            bar.css(\"width\", percent+\"%\").text(percent+\"%\");\n          },\n          allcomplete: function(response) {\n            bar.css(\"width\", \"100%\").text(\"100%\");\n            setTimeout(function(){\n              progressbar.addClass(\"uk-hidden\");\n            }, 250);\n            $.UIkit.notify(\"<i class='uk-icon-check'></i> Успешно загружено и отправлено в очередь на выполнение.<br />Состояние можно посмотреть на странице <a href='/zadaniya'>&laquo;Задания&raquo;</a>.\", {status:'success'})\n          }\n        };\n    var select = $.UIkit.uploadSelect($(\"#upload-select\"), settings),\n        drop   = $.UIkit.uploadDrop($(\"#upload-drop\"), settings);\n  }\n});"],"sourceRoot":"/source/"}